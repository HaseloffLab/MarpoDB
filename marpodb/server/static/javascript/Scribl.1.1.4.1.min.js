function ScriblWrapLines(a,b){var c=[];b=""+b;for(var d="",f=0,g=b.split(" "),h=0;h<g.length;h++)g[h].length+d.length<=a?d+=" "+g[h]:""==d?(trunc1=g[h].slice(0,a-1),d+=" "+trunc1+"-",trunc2=g[h].slice(a,g[h].length),g.splice(h+1,0,trunc2),c.push(d),d="",f++):(h--,c.push(d),f++,d="");return f++,c.push(d),[c,f]}function bed(a,b){var c=a.split("\n");c[0];numFeatures=c.length;for(var h=1;h<numFeatures&&""!=c[h];h++)for(var i=c[h].split(" "),j=parseInt(i[1]),k=parseInt(i[2]),l=i[0]+": "+i[3],m=i[5],n=i[8],o=i[10].split(","),p=i[11].split(","),q=b.addFeature(new Complex("complex",j,k,m,[],{color:n,name:l})),r=0;r<o.length&&""!=o[r];r++)q.addSubFeature(new BlockArrow("complex",parseInt(p[r]),parseInt(o[r]),m))}function genbank(a,b){for(var c=a.split("\n"),d=new RegExp(/\s+gene\s+([a-z]*)\(?(\d+)\.\.(\d+)/),e=[],f=void 0,g=void 0,h=0;h<c.length;h++){var i;if(i=c[h].match(d)){i.shift(),e.push(i);var j=i[2];(void 0==f||f>j)&&(f=j);var k=i[1];(void 0==g||g<k)&&(g=k)}}b.scale.max=f,b.scale.min=g;for(var l=0;l<e.length;l++){var m="+";"complement"==e[l][0]&&(m="-");var k=e[l][1],j=e[l][2];k=k-1+1;var n=j-k;b.addGene(k,n,m)}}!function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function g(){!a&&this.init&&this.init.apply(this,arguments)}var d=this.prototype;a=!0;var e=new this;a=!1;for(var f in c)e[f]="function"==typeof c[f]&&"function"==typeof d[f]&&b.test(c[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);return this._super=c,e}}(f,c[f]):c[f];return g.prototype=e,g.constructor=g,g.extend=arguments.callee,g}}();var MouseEventHandler=Class.extend({init:function(a){this.chart=a,this.mouseX=null,this.mouseY=null,this.eventElement=void 0,this.isEventDetected=!1,this.tooltip=new Tooltip("","above",-4)},addEvents:function(a){var b=this.chart,c=b.ctx,d=b.myMouseEventHandler;a.onMouseover&&!b.events.hasMouseover?(b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseover),b.events.hasMouseover=!0):a.tooltips.length>0&&!b.events.hasMouseover?(b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseover),b.events.hasMouseover=!0):a.parent&&a.parent.tooltips.length>0&&!b.events.hasMouseover?(b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseover),b.events.hasMouseover=!0):a.parent&&a.parent.onMouseover&&!b.events.hasMouseover&&(b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseover),b.events.hasMouseover=!0),a.onClick&&!b.events.hasClick?(b.addClickEventListener(b.myMouseEventHandler.handleClick),b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseStyle),b.events.hasClick=!0):a.parent&&a.parent.onClick&&!b.events.hasClick&&(b.addClickEventListener(b.myMouseEventHandler.handleClick),b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseStyle),b.events.hasClick=!0),!d.isEventDetected&&c.isPointInPath_mozilla(d.mouseX,d.mouseY)&&(d.eventElement=a,d.isEventDetected=!0)},setMousePosition:function(a){if(null!=a){var b=this.chart.canvas.getBoundingClientRect();this.mouseX=a.clientX-b.left,this.mouseY=a.clientY-b.top}},handleClick:function(a){var d,b=a.myMouseEventHandler,c=b.eventElement;void 0!=c&&void 0!=c.onClick?d=c.onClick:c&&c.parent&&c.parent.onClick&&(d=c.parent.onClick),d&&("string"==typeof d?window.open(d):"function"==typeof d&&d(c))},handleMouseover:function(a){var b=a.myMouseEventHandler,c=b.eventElement;c&&void 0==c.onMouseover&&c.parent&&c.parent.onMouseover&&(c.onMouseover=c.parent.onMouseover),c&&c.onMouseover&&("string"==typeof c.onMouseover?b.tooltip.fire(c):"function"==typeof c.onMouseover&&c.onMouseover(c)),c&&c.tooltips.length>0&&c.fireTooltips()},handleMouseStyle:function(a){var b=a.myMouseEventHandler,c=b.eventElement,d=a.ctx;c&&void 0!=c.onClick?d.canvas.style.cursor="pointer":c&&c.parent&&void 0!=c.parent.onClick?d.canvas.style.cursor="pointer":d.canvas.style.cursor="auto"},reset:function(a){var b=a.myMouseEventHandler;b.mouseX=null,b.mouseY=null,b.eventElement=void 0,b.isEventDetected=null,b.elementIndexCounter=0}});CanvasRenderingContext2D.prototype.isPointInPath_mozilla=function(a,b){if(navigator.userAgent.indexOf("Firefox")!=-1){this.save(),this.setTransform(1,0,0,1,0,0);var c=this.isPointInPath(a,b);this.restore()}else var c=this.isPointInPath(a,b);return c};var Glyph=Class.extend({init:function(a,b,c,d,e){var f=this;this.uid=_uniqueId("feature"),f.position=b,f.length=c,f.strand=d,this.type=a,f.opts={},f.name="",f.borderColor="none",f.borderWidth=void 0,f.ntLevel=4,f.tooltips=[],f.hooks={},f.addDrawHook(function(a){if(void 0!=a.ntLevel&&a.seq&&a.lane.chart.ntsToPixels()<a.ntLevel){var b=new Seq(a.type,a.position,a.length,a.seq,a.opts);return b.lane=a.lane,b.ctx=a.ctx,b._draw(),!0}return!1},"ntHook"),f.text={},f.text.font=void 0,f.text.size=void 0,f.text.color=void 0,f.text.align=void 0,f.onClick=void 0,f.onMouseover=void 0;for(var g in e)f[g]=e[g],f.opts[g]=e[g]},setColorGradient:function(){if(1==arguments.length)return void(this.color=arguments[0]);for(var b,a=this.lane.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight()),c=0;b=arguments[c],c<arguments.length;c++)a.addColorStop(c/(arguments.length-1),b);this.color=a},getPixelLength:function(){var a=this;return a.lane.chart.pixelsToNts(a.length)||1},getPixelPositionX:function(){var a=this,b=parseInt(a.lane.track.chart.offset)||0;if(a.parent)var c=a.position+a.parent.position-a.lane.track.chart.scale.min;else var c=a.position-a.lane.track.chart.scale.min;return a.lane.track.chart.pixelsToNts(c)+b},getPixelPositionY:function(){var a=this;return a.lane.getPixelPositionY()},getEnd:function(){return this.position+this.length},clone:function(glyphType){var glyph=this,newFeature;if(glyphType=glyphType||glyph.glyphType,"Rect"!=glyphType&&"Line"!=glyphType||(glyph.strand=void 0),glyph.strand){var str="new "+glyphType+'("'+glyph.type+'",'+glyph.position+","+glyph.length+',"'+glyph.strand+'",'+JSON.stringify(glyph.opts)+")";newFeature=eval(str);for(var attrs=Object.keys(glyph),i=0;i<attrs.length;i++)newFeature[attrs[i]]=glyph[attrs[i]]}else{var str="new "+glyphType+'("'+glyph.type+'",'+glyph.position+","+glyph.length+","+JSON.stringify(glyph.opts)+")";newFeature=eval(str);for(var attrs=Object.keys(glyph),i=0;i<attrs.length;i++)newFeature[attrs[i]]=glyph[attrs[i]]}return newFeature.tooltips=glyph.tooltips,newFeature.hooks=glyph.hooks,newFeature},getAttr:function(a){for(var b=this,c=a.split("-"),d=b,e=0;e<c.length;e++)d=d[c[e]];if(d)return d;if(b.parent){for(var f=b.parent,e=0;e<c.length;e++)f=f[c[e]];if(f)return f}var g=this.lane.chart[b.type];if(g){for(var e=0;e<c.length;e++)g=g[c[e]];if(g)return g}for(var h=b.lane.chart.glyph,e=0;e<c.length;e++)h=h[c[e]];return h?h:void 0},drawText:function(a){var b=this,c=b.lane.chart.ctx,d=5,e=b.getPixelLength(),f=b.getHeight(),g=b.getAttr("text-size"),h=8,i=b.getAttr("text-style");c.font=g+"px "+i,c.textBaseline="middle",c.fillStyle=b.getAttr("text-color");var j=void 0,k=b.getAttr("text-align");"start"==k?k="+"==b.strand?"left":"right":"end"==k&&(k="+"==b.strand?"right":"left"),c.textAlign=k,"left"==k?j=0+d:"center"==k?j=e/2:"right"==k&&(j=e-d);var l=c.measureText(a);if(a&&""!=a){for(;e-l.width<4;)if(g=/^\d+/.exec(c.font),g--,l=c.measureText(a),c.font=g+"px "+i,g<=h){a="";break}if("Complex"==b.glyphType){var m=0,n=/^\d+/.exec(c.font);"center"==k&&(m=-(c.measureText(a).width/2+d/2)),c.clearRect(j+m,f/2-n/2,c.measureText(a).width+d,n)}c.fillText(a,j,f/2)}},calcRoundness:function(){var a=this.getHeight()*this.getAttr("roundness")/100;return a=(10*a%5>=2.5?5*parseInt(10*a/5)+5:5*parseInt(10*a/5))/10},isContainedWithinRect:function(a,b,c,d){var e=this,f=e.getPixelPositionY(),g=e.getPixelPositionX(),h=f,i=e.getPixelPositionX()+e.getPixelLength(),j=f+e.getHeight();return g>=a&&i<=c&&h>=b&&j<=d},getHeight:function(){var a=this;return a.lane.getHeight()},getFillStyle:function(){var a=this,b=a.getAttr("color");if(b instanceof Array){for(var d,c=this.lane.track.chart.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight()),e=0;d=b[e],e<b.length;e++)c.addColorStop(e/(b.length-1),d);return c}if(b instanceof Function){var c=this.lane.track.chart.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight());return b(c)}return b},getStrokeStyle:function(){var a=this,b=a.getAttr("borderColor");if("object"==typeof b){for(var d,c=this.lane.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight()),e=0;d=b[e],e<b.length;e++)c.addColorStop(e/(b.length-1),d);return c}return b},isSubFeature:function(){return void 0!=this.parent},erase:function(){var a=this;a.ctx.save(),a.ctx.setTransform(1,0,0,1,0,0),a.ctx.clearRect(a.getPixelPositionX(),a.getPixelPositionY(),a.getPixelLength(),a.getHeight()),a.ctx.restore()},addDrawHook:function(a,b){var c=b||_uniqueId("drawHook");return this.hooks[c]=a,c},removeDrawHook:function(a){delete this.hooks[a]},addTooltip:function(a,b,c,d){var e=this,f=new Tooltip(a,b,c,d);f.feature=e,e.tooltips.push(f)},fireTooltips:function(){for(var a=0;a<this.tooltips.length;a++)this.tooltips[a].fire()},draw:function(){var a=this;a.ctx=a.lane.chart.ctx,a.ctx.beginPath();var c=(/^\d+/.exec(a.ctx.font),/\S+$/.exec(a.ctx.font)),d=10;a.onClick=a.getAttr("onClick"),a.onMouseover=a.getAttr("onMouseover"),a.ctx.fillStyle=a.getFillStyle();var e=a.ctx.fillStyle,f=a.getPixelPositionX(),g=a.getHeight();g<d?a.ctx.font=d+"px "+c:a.ctx.font=.9*g+"px "+c,a.ctx.translate(f,0),"-"!=a.strand||a.isSubFeature()||a.ctx.transform(-1,0,0,1,a.getPixelLength(),0);var h=!1;for(var i in a.hooks)h=a.hooks[i](a)||h;if(h||a._draw(),"none"!=a.borderColor){"none"==a.color&&"Complex"==a.parent.glyphType&&a.erase();var j=a.ctx.strokeStyle,k=a.ctx.lineWidth;a.ctx.strokeStyle=a.getStrokeStyle(),a.ctx.lineWidth=a.getAttr("borderWidth"),a.ctx.stroke(),a.ctx.strokeStyle=j,a.ctx.lineWidth=k}"none"!=a.color&&a.ctx.fill(),"-"!=a.strand||a.isSubFeature()||a.ctx.transform(-1,0,0,1,a.getPixelLength(),0),a.drawText(a.getAttr("name")),a.ctx.translate(-f,0),a.ctx.fillStyle=e,a.lane.chart.myMouseEventHandler.addEvents(this)},redraw:function(){var a=this;a.lane.ctx.save(),a.erase;var b=a.getPixelPositionY();a.lane.ctx.translate(0,b),a.draw(),a.lane.ctx.restore()}}),SCRIBL={};SCRIBL.chars={},SCRIBL.chars.nt_color="white",SCRIBL.chars.nt_A_bg="red",SCRIBL.chars.nt_G_bg="blue",SCRIBL.chars.nt_C_bg="green",SCRIBL.chars.nt_T_bg="black",SCRIBL.chars.nt_N_bg="purple",SCRIBL.chars.nt_dash_bg="rgb(120,120,120)",SCRIBL.chars.heights=[],SCRIBL.chars.canvasHolder=document.createElement("canvas");var Scribl=Class.extend({init:function(a,b){this.scrolled=!1;var c;a&&(c=a.getContext("2d"));var d=this;this.width=b,this.uid=_uniqueId("chart"),this.laneSizes=50,this.laneBuffer=5,this.trackBuffer=25,this.offset=void 0,this.canvas=a,this.ctx=c,this.scale={},this.scale.pretty=!0,this.scale.max=void 0,this.scale.min=void 0,this.scale.auto=!0,this.scale.userControlled=!1,this.scale.positions=[0],this.scale.off=!1,this.scale.size=15,this.scale.font={},this.scale.font.size=15,this.scale.font.color="black",this.scale.font.buffer=10,this.glyph={},this.glyph.roundness=6,this.glyph.borderWidth=1,this.glyph.color=["#99CCFF","rgb(63, 128, 205)"],this.glyph.text={},this.glyph.text.color="black",this.glyph.text.size="13",this.glyph.text.font="arial",this.glyph.text.align="center",this.gene={},this.gene.text={},this.protein={},this.protein.text={},this.events={},this.events.hasClick=!1,this.events.hasMouseover=!1,this.events.clicks=new Array,this.events.mouseovers=new Array,this.events.added=!1,this.mouseHandler=function(a){d.handleMouseEvent(a,"mouseover")},this.clickHandler=function(a){d.handleMouseEvent(a,"click")},this.tick={},this.tick.auto=!0,this.tick.major={},this.tick.major.size=10,this.tick.major.color="black",this.tick.minor={},this.tick.minor.size=1,this.tick.minor.color="rgb(55,55,55)",this.tick.halfColor="rgb(10,10,10)",this.tooltips={},this.tooltips.text={},this.tooltips.text.font="arial",this.tooltips.text.size=12,this.tooltips.borderWidth=1,this.tooltips.roundness=5,this.tooltips.fade=!1,this.tooltips.style="light",this.lastToolTips=[],this.scrollable=!1,this.scrollValues=[0,void 0],this.chars={},this.chars.drawOnBuild=[],this.drawStyle="expand",this.glyphHooks=[],this.trackHooks=[],this.myMouseEventHandler=new MouseEventHandler(this),this.tracks=[];this.scale.size,this.scale.font.size},getScaleHeight:function(){return this.scale.font.size+this.scale.size},getHeight:function(){var a=0;this.scale.off||(a+=this.getScaleHeight());for(var b=this.tracks.length,c=0;c<b;c++)a+=this.trackBuffer,a+=this.tracks[c].getHeight();return a},getFeatures:function(){for(var a=[],b=0;b<this.tracks.length;b++)for(var c=0;c<this.tracks[b].lanes.length;c++)a=a.concat(this.tracks[b].lanes[c].features);return a},setCanvas:function(a){this.canvas=a,this.ctx=a.getContext("2d")},addScale:function(){this.scale.userControlled?this.scale.positions.push(this.tracks.length):(this.scale.positions=[this.tracks.length],this.scale.userControlled=!0)},addTrack:function(){var a=new Track(this);return 1==this.tracks.length&&void 0==this.tracks[0]&&(this.tracks=[]),this.tracks.push(a),a},removeTrack:function(a){for(var b=this,c=0;c<b.tracks.length;c++)a.uid==b.tracks[c].uid&&b.tracks.splice(c,1);delete a},loadGenbank:function(a){genbank(a,this)},loadBed:function(a){bed(a,this)},loadBam:function(a,b,c,d,e,f){var g=this,h=g.addTrack();return h.status="waiting",makeBam(new BlobFetchable(a),new BlobFetchable(b),function(a,b){g.file=a,a.fetch(c,d,e,function(a,b){if(a){for(var c=0;c<a.length;c+=1)h.addFeature(new BlockArrow("bam",a[c].pos,a[c].lengthOnRef,"+",{seq:a[c].seq}));h.status="received",h.drawOnResponse&&g.redraw()}b&&alert("error: "+b)})}),h},loadFeatures:function(a){for(var b=0;b<a.length;b++)this.addFeature(a[b])},addGene:function(a,b,c,d){return this.addFeature(new BlockArrow("gene",a,b,c,d))},addProtein:function(a,b,c,d){return this.addFeature(new BlockArrow("protein",a,b,c,d))},addFeature:function(a){var b=this.tracks[0]||this.addTrack();return b.addFeature(a),a},slice:function(a,b,c){c=c||"inclusive";var f=this.tracks.length,g=new Scribl(this.canvas,this.width);g.scale.min=this.scale.min,g.scale.max=this.scale.max,g.offset=this.offset,g.scale.off=this.scale.off,g.scale.pretty=this.scale.pretty,g.laneSizes=this.laneSizes,g.drawStyle=this.drawStyle,g.glyph=this.glyph,g.glyphHooks=this.glyphHooks,g.trackHooks=this.trackHooks,g.previousDrawStyle=this.previousDrawStyle;for(var h=0;h<f;h++){var i=this.tracks[h],j=g.addTrack();j.drawStyle=i.drawStyle;for(var k=i.lanes.length,l=0;l<k;l++)for(var m=j.addLane(),n=i.lanes[l].features,o=0;o<n.length;o++){var p=n[o].position+n[o].length,q=n[o].position;if("inclusive"==c)q>=a&&q<=b?m.addFeature(n[o].clone()):p>a&&p<b?m.addFeature(n[o].clone()):q<a&&p>b?m.addFeature(n[o].clone()):q>a&&p<b&&m.addFeature(n[o].clone());else if("strict"==c){if(q>=a&&q<=b)if(p>a&&p<b)m.addFeature(n[o].clone());else{if("BlockArrow"==n[o].glyphType&&"+"==n[o].strand)var r=n[o].clone("Rect");else var r=n[o].clone();r.length=Math.abs(b-q),m.addFeature(r)}else if(p>a&&p<b){if("BlockArrow"==n[o].glyphType&&"-"==n[o].strand)var r=n[o].clone("Rect");else var r=n[o].clone();r.position=a,r.length=Math.abs(p-a),m.addFeature(r)}else if(q<a&&p>b){if("BlockArrow"==n[o].glyphType)var r=n[o].clone("Rect");else var r=n[o].clone();r.position=a,r.length=Math.abs(b-a),m.addFeature(r)}}else"exclusive"==c&&q>=a&&q<=b&&p>a&&p<b&&m.addFeature(n[o].clone())}}return g},draw:function(){var a=this.ctx,b=this.tracks;1==this.scrollable&&this.initScrollable(),a.save(),this.initScale(),void 0==this.offset&&(this.offset=Math.ceil(a.measureText("0").width/2+10)),a.save();for(var c=0;c<b.length;c++)this.scale.off||this.scale.positions.indexOf(c)==-1||this.drawScale(),b[c].draw();this.scale.off||this.scale.positions.indexOf(b.length)==-1||this.drawScale(),a.restore(),a.restore(),this.events.added||this.registerEventListeners()},redraw:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.tracks.length>0&&this.draw()},initScale:function(){this.scale.pretty&&(this.tick.auto&&(this.tick.major.size=this.determineMajorTick(),this.tick.minor.size=Math.round(this.tick.major.size/10)),this.scale.auto&&(this.scale.min-=this.scale.min%this.tick.major.size,this.scale.max=Math.round(this.scale.max/this.tick.major.size+.4)*this.tick.major.size))},drawScale:function(a){var b,c=this.ctx,d=c.fillStyle;a&&a.init&&this.initScale();var e=this.scale.font.size+this.scale.size,f=this.scale.font.size+2,g=this.scale.font.size+.66*this.scale.size,h=this.scale.font.size+.33*this.scale.size;c.font=this.scale.font.size+"px arial",c.textBaseline="top",c.fillStyle=this.scale.font.color,void 0==this.offset&&(this.offset=Math.ceil(c.measureText("0").width/2+10)),b=this.scale.min%this.tick.minor.size==0?this.scale.min:this.scale.min-this.scale.min%this.tick.minor.size+this.tick.minor.size;for(var i=b;i<=this.scale.max;i+=this.tick.minor.size){if(c.beginPath(),187250==i);var k=this.pixelsToNts(i-this.scale.min)+this.offset;if(i%this.tick.major.size==0){var l=this.getTickText(i);c.textAlign="center",c.fillText(l,k,0),c.moveTo(k,e),c.lineTo(k,f),c.strokeStyle=this.tick.major.color,c.stroke()}else c.moveTo(k,e),i%(this.tick.major.size/2)==0?(c.strokeStyle=this.tick.halfColor,c.lineTo(k,h)):(c.strokeStyle=this.tick.minor.color,c.lineTo(k,g)),c.stroke()}c.fillStyle=d,c.translate(0,this.getScaleHeight()+this.laneBuffer)},pixelsToNts:function(a){return void 0==a?this.width/(this.scale.max-this.scale.min):this.width/(this.scale.max-this.scale.min)*a},ntsToPixels:function(a){return void 0==a?1/this.pixelsToNts():a/this.width},initScrollable:function(){var a;if(!this.scrolled){var b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div");d.id="scribl-zoom-slider",d.className="slider",d.style.cssFloat="left",d.style.height=new String(.5*this.canvas.height)+"px",d.style.margin="30px auto auto -20px",b.style.cssText=this.canvas.style.cssText,this.canvas.style.cssText="",parentWidth=parseInt(this.canvas.width)+25,b.style.width=parentWidth+"px",c.style.width=this.canvas.width+"px",c.style.overflow="auto",c.id="scroll-wrapper",this.canvas.parentNode.replaceChild(b,this.canvas),b.appendChild(d),c.appendChild(this.canvas),b.appendChild(c),jQuery(c).dragscrollable({dragSelector:"canvas:first",acceptPropagatedEvent:!1})}var e=this.scale.max-this.scale.min,f=this.scrollValues[1]||this.scale.max-.35*e;a=void 0!=this.scrollValues[0]?this.scrollValues[0]:this.scale.max+.35*e;var g=f-a,h=g/document.getElementById("scroll-wrapper").style.width.split("px")[0],i=e/h||100;this.canvas.width=i,this.width=i-30,schart=this;var j=(f-a)/(this.scale.max-this.scale.min)*100||1;jQuery(d).slider({orientation:"vertical",range:"min",min:6,max:100,value:j,slide:function(a,b){var c=schart.scale.max-schart.scale.min,e=(b.value/100*c,b.value/100*schart.canvas.width),f=document.getElementById("scroll-wrapper"),g=f.scrollLeft+parseInt(f.style.width.split("px")[0])/2,h=g-e/2,i=g+e/2,j=schart.scale.min+h/schart.canvas.width*c,k=schart.scale.min+i/schart.canvas.width*c;schart.scrollValues=[j,k],schart.ctx.clearRect(0,0,schart.canvas.width,schart.canvas.height),schart.draw()}});var k=(a-this.scale.min)/e*this.canvas.width;document.getElementById("scroll-wrapper").scrollLeft=k,this.scrolled=!0},determineMajorTick:function(){this.ctx.font=this.scale.font.size+"px arial";var a=this.width/(this.ctx.measureText(this.getTickTextDecimalPlaces(this.scale.max)).width+this.scale.font.buffer),b=(this.scale.max-this.scale.min)/a,c=Math.pow(10,parseInt(b).toString().length-1);this.tick.major.size=Math.ceil(b/c)*c;var d=(this.tick.major.size+"").length,e=Math.pow(10,d),f=this.tick.major.size/e;return f>.1&&f<=.5?f=.5:f>.5&&(f=1),f*e},getTickText:function(a){if(!this.tick.auto)return a;var b=a;if(a>=1e6){var c=5,d=Math.pow(10,c);b=Math.round(b/1e6*d)/d+"m"}else if(a>=1e3){var c=2,d=Math.pow(10,c);b=Math.round(b/1e3*d)/d+"k"}return b},getTickTextDecimalPlaces:function(a){if(!this.tick.auto)return a;var b=a;if(a>=1e6){var c=5;b=Math.round(b/(1e6/Math.pow(10,c)))+"m"}else if(a>=1e3){var c=2;b=Math.round(b/(1e3/Math.pow(10,c)))+"k"}return b},handleMouseEvent:function(a,b){this.myMouseEventHandler.setMousePosition(a);for(var d,c=this.myMouseEventHandler.mouseY,e=0;e<this.tracks.length;e++)for(var f=0;f<this.tracks[e].lanes.length;f++){var g=this.tracks[e].lanes[f].getPixelPositionY(),h=g+this.tracks[e].lanes[f].getHeight();if(c>=g&&c<=h){d=this.tracks[e].lanes[f];break}}if(!d)return void draworig();var i=d.track.getDrawStyle();if("collapse"==i)this.redraw();else if("line"==i);else{this.ctx.save(),d.erase(),this.ctx.translate(0,d.getPixelPositionY()),d.draw();for(var j;j=this.lastToolTips.pop();)this.ctx.putImageData(j.pixels,j.x,j.y);this.ctx.restore()}var k=this;if("click"==b)for(var l=k.events.clicks,e=0;e<l.length;e++)l[e](k);else for(var m=k.events.mouseovers,e=0;e<m.length;e++)m[e](k);this.myMouseEventHandler.reset(k)},addClickEventListener:function(a){this.events.clicks.push(a)},addMouseoverEventListener:function(a){this.events.mouseovers.push(a)},removeEventListeners:function(a){"mouseover"==a?this.canvas.removeEventListener("mousemove",this.mouseHandler):"click"==a&&this.canvas.removeEventListener("click",this.clickHandler)},registerEventListeners:function(){var a=this;this.events.mouseovers.length>0&&(this.canvas.removeEventListener("mousemove",a.mouseHandler),this.canvas.addEventListener("mousemove",a.mouseHandler,!1)),this.events.clicks.length>0&&(this.canvas.removeEventListener("click",a.clickHandler),this.canvas.addEventListener("click",a.clickHandler,!1)),this.events.added=!0}}),Lane=Class.extend({init:function(a,b){this.height=void 0,this.features=[],this.ctx=a,this.track=b,this.chart=b.chart,this.uid=_uniqueId("lane")},addGene:function(a,b,c,d){return this.addFeature(new BlockArrow("gene",a,b,c,d))},addProtein:function(a,b,c,d){return this.addFeature(new BlockArrow("protein",a,b,c,d))},addFeature:function(a){return a.lane=this,this.features.push(a),this.chart[a.type]||(this.chart[a.type]={text:{}}),(a.length+a.position>this.chart.scale.max||!this.chart.scale.max)&&(this.chart.scale.max=a.length+a.position),(a.position<this.chart.scale.min||!this.chart.scale.min)&&(this.chart.scale.min=a.position),a},loadFeatures:function(a){for(var b=a.length,c=0;c<b;c++)this.addFeature(a[c])},getHeight:function(){return void 0!=this.height?this.height:this.chart.laneSizes},getPixelPositionY:function(){for(var a=this,b=a.track.getPixelPositionY(),c=a.getHeight(),d=0;d<a.track.lanes.length&&a.uid!=a.track.lanes[d].uid;d++)b+=a.track.chart.laneBuffer,b+=c;return b},erase:function(){var a=this;a.chart.ctx.clearRect(0,a.getPixelPositionY(),a.track.chart.canvas.width,a.getHeight())},draw:function(){for(var a=this.track.chart.scale.min,b=this.track.chart.scale.max,c=!1,d=0;d<this.features.length;d++){var e=this.features[d].position,f=this.features[d].getEnd();(e>=a&&e<=b||f>=a&&f<=b)&&(this.features[d].draw(),c=!0)}return c},filterFeaturesByPosition:function(a,b){for(var c=this,d=[],e=c.features.length,f=0;f<e;f++){var g=c.features[f].position,h=c.features[f].getEnd();(g>=a&&g<=b||h>=a&&h<=b)&&d.push(c.features[f])}return d}}),CanvasToSVG={idCounter:0,convert:function(a,b,c,d){var e="http://www.w3.org/2000/svg",f="http://www.w3.org/1999/xlink",g=a.toDataURL(),h=document.createElementNS(e,"image");h.setAttribute("id","importedCanvas_"+this.idCounter++),h.setAttributeNS(f,"xlink:href",g),h.setAttribute("x",c?c:0),h.setAttribute("y",d?d:0),h.setAttribute("width",a.width),h.setAttribute("height",a.height),h.imageData=a.toDataURL(),b.appendChild(h)}},toXml=function(a){return $("<p/>").text(a).html()},svgToString=function(a){for(;removeUnusedDefElems()>0;);pathActions.clear(!0),$.each(a.childNodes,function(b,c){b&&8==c.nodeType&&c.data.indexOf("Created with")>=0&&a.insertBefore(c,a.firstChild)}),current_group&&(leaveContext(),selectOnly([current_group]));var b=[];$(a).find("g:data(gsvg)").each(function(){for(var a=this.attributes,c=a.length,d=0;d<c;d++)"id"!=a[d].nodeName&&"style"!=a[d].nodeName||c--;if(c<=0){var e=this.firstChild;b.push(e),$(this).replaceWith(e)}});var c=svgToString(a,0);return b.length&&$(b).each(function(){groupSvgElem(this)}),c},svgToString=function(a,b){var c=new Array;if(a){for(var e,f,d=a.attributes,g=a.childNodes,f=0;f<b;f++)c.push(" ");if(c.push("<"),c.push(a.nodeName),"svgcontent"==a.id){var h=getResolution();c.push(' width="'+h.w+'" height="'+h.h+'" xmlns="'+svgns+'"');var i={};$(a).find("*").andSelf().each(function(){$.each(this.attributes,function(a,b){var d=b.namespaceURI;d&&!i[d]&&"xmlns"!==nsMap[d]&&"xml"!==nsMap[d]&&(i[d]=!0,c.push(" xmlns:"+nsMap[d]+'="'+d+'"'))})});for(var f=d.length;f--;){e=d.item(f);var j=toXml(e.nodeValue);0!==e.nodeName.indexOf("xmlns:")&&""!=j&&["width","height","xmlns","x","y","viewBox","id","overflow"].indexOf(e.localName)==-1&&(e.namespaceURI&&!nsMap[e.namespaceURI]||(c.push(" "),c.push(e.nodeName),c.push('="'),c.push(j),c.push('"')))}}else for(var f=d.length-1;f>=0;f--){e=d.item(f);var j=toXml(e.nodeValue);if(!(["-moz-math-font-style","_moz-math-font-style"].indexOf(e.localName)>=0)&&""!=j){if(0===j.indexOf("pointer-events"))continue;if("class"===e.localName&&0===j.indexOf("se_"))continue;c.push(" "),"d"===e.localName&&(j=pathActions.convertPath(a,!0)),c.push(e.nodeName),c.push('="'),c.push(j),c.push('"')}}if(a.hasChildNodes()){c.push(">"),b++;for(var k=!1,f=0;f<g.length;f++){var l=g.item(f);switch(l.nodeType){case 1:c.push("\n"),c.push(svgToString(g.item(f),b));break;case 3:var m=l.nodeValue.replace(/^\s+|\s+$/g,"");""!=m&&(k=!0,c.push(toXml(m)+""));break;case 8:c.push("\n"),c.push(new Array(b+1).join(" ")),c.push("<!--"),c.push(l.data),c.push("-->")}}if(b--,!k){c.push("\n");for(var f=0;f<b;f++)c.push(" ")}c.push("</"),c.push(a.nodeName),c.push(">")}else c.push("/>")}return c.join("")},Tooltip=Class.extend({init:function(a,b,c,d){var e=this;e.text=a,e.placement=b||"above",e.verticalOffset=c||0;for(var f in d)e[f]=d[f];e.horizontalOffset=e.horizontalOffset||0,e.ntOffset=e.ntOffset||0},fire:function(a){var b=a||this.feature;this.chart=b.lane.track.chart,this.ctx=this.chart.ctx,this.draw(b,1)},draw:function(a,b){this.ctx.globalAlpha=b;var c=this.chart.tooltips.roundness,d=this.chart.tooltips.text.font,e=this.chart.tooltips.text.size,f=this.text||a.onMouseover;this.ctx.save(),this.ctx.font=e+"px "+d;var l,m,g=this.ctx.measureText(f),h=[f],i=e+10,j=g.width+10,n=0;if(a.seq){var o=a.getPixelLength();n=this.ntOffset*(o/a.length)}var q,p=a.getPixelPositionX()+this.horizontalOffset+n;q="below"==this.placement?a.getPixelPositionY()+a.getHeight()-this.verticalOffset:a.getPixelPositionY()-i-this.verticalOffset;var s=(a.getPixelLength(),200);if(j>s){var t=this.ctx.measureText("s").width,u=parseInt(s/t),v=ScriblWrapLines(u,f);j=s+10,i=v[1]*e+10,h=v[0]}j+p>this.chart.width&&(p=this.chart.width-j),"light"==this.chart.tooltips.style?(l=this.chart.ctx.createLinearGradient(p+j/2,q,p+j/2,q+i),l.addColorStop(0,"rgb(253, 248, 196)"),l.addColorStop(.75,"rgb(253, 248, 196)"),l.addColorStop(1,"white"),m=this.chart.ctx.createLinearGradient(p+j/2,q,p+j/2,q+i),m.addColorStop(0,"black"),m.addColorStop(1,"rgb(64, 64, 64)"),this.chart.tooltips.text.color="black"):"dark"==this.chart.tooltips.style&&(l=this.chart.ctx.createLinearGradient(p+j/2,q,p+j/2,q+i),l.addColorStop(0,"rgb(64, 64, 64)"),l.addColorStop(1,"rgb(121, 121, 121)"),m="white",this.chart.tooltips.text.color="white"),this.chart.lastToolTips.push({pixels:this.ctx.getImageData(p-1,q-1,j+2,i+2),x:p-1,y:q-1}),this.ctx.fillStyle=l,this.ctx.beginPath(),tlc_ctrl_x=p,tlc_ctrl_y=q,tlc_lgth_x=p+c,tlc_lgth_y=q,tlc_wdth_x=p,tlc_wdth_y=q+c,blc_ctrl_x=p,blc_ctrl_y=q+i,blc_lgth_x=p+c,blc_lgth_y=q+i,blc_wdth_x=p,blc_wdth_y=q+i-c,brc_ctrl_x=p+j,brc_ctrl_y=q+i,brc_lgth_x=p+j-c,brc_lgth_y=q+i,brc_wdth_x=p+j,brc_wdth_y=q+i-c,trc_ctrl_x=p+j,trc_ctrl_y=q,trc_lgth_x=p+j-c,trc_lgth_y=q,trc_wdth_x=p+j,trc_wdth_y=q+c,this.ctx.moveTo(tlc_lgth_x,tlc_lgth_y),this.ctx.quadraticCurveTo(tlc_ctrl_x,tlc_ctrl_y,tlc_wdth_x,tlc_wdth_y),this.ctx.lineTo(blc_wdth_x,blc_wdth_y),this.ctx.quadraticCurveTo(blc_ctrl_x,blc_ctrl_y,blc_lgth_x,blc_lgth_y),this.ctx.lineTo(brc_lgth_x,brc_lgth_y),this.ctx.quadraticCurveTo(brc_ctrl_x,brc_ctrl_y,brc_wdth_x,brc_wdth_y),this.ctx.lineTo(trc_wdth_x,trc_wdth_y),this.ctx.quadraticCurveTo(trc_ctrl_x,trc_ctrl_y,trc_lgth_x,trc_lgth_y),this.ctx.lineTo(tlc_lgth_x,tlc_lgth_y),this.ctx.fill(),this.ctx.lineWidth=this.chart.tooltips.borderWidth,this.ctx.strokeStyle=m,this.ctx.stroke(),this.ctx.textBaseline="middle",this.ctx.fillStyle=this.chart.tooltips.text.color;for(var w=0;w<h.length;w++){var g=this.ctx.measureText(h[w]);this.ctx.fillText(h[w],p+5,q+e*(w+1))}this.ctx.restore()}}),Track=Class.extend({init:function(a){this.chart=a,this.lanes=[],this.ctx=a.ctx,this.uid=_uniqueId("track"),this.drawStyle=void 0,this.hide=!1,this.hooks={};for(var c=0;c<a.trackHooks.length;c++)this.addDrawHook(a.trackHooks[c]);this.coverageData=[],this.maxDepth=0},addLane:function(){var a=new Lane(this.ctx,this);return this.lanes.push(a),a},addGene:function(a,b,c,d){return this.addFeature(new BlockArrow("gene",a,b,c,d))},addProtein:function(a,b,c,d){return this.addFeature(new BlockArrow("protein",a,b,c,d))},addFeature:function(a){for(var b,c=!0,d=0;d<this.lanes.length;d++){var e=this.lanes[d].features[this.lanes[d].features.length-1],f=3/this.chart.pixelsToNts()||3;if(void 0!=e&&a.position-f>e.position+e.length){c=!1,b=this.lanes[d];break}}return c&&(b=this.addLane()),b.addFeature(a),a},hide:function(){this.hide=!0},unhide:function(){this.hide=!1},getDrawStyle:function(){return this.drawStyle?this.drawStyle:this.chart.drawStyle},getHeight:function(){var a=0,b=this.lanes.length,c=this.chart.laneBuffer,d=this.getDrawStyle();"line"!=d&&"collapse"!=d||(b=1);for(var e=0;e<b;e++)a+=c,a+=this.lanes[e].getHeight();return a-=c},getPixelPositionY:function(){var b,a=this;b=a.chart.scale.off?0:a.chart.getScaleHeight()+a.chart.laneBuffer;for(var c=0;c<a.chart.tracks.length&&a.uid!=a.chart.tracks[c].uid;c++)b+=a.chart.trackBuffer,b+=a.chart.tracks[c].getHeight();return b},calcCoverageData:function(){for(var a=this.lanes,b=this.chart.scale.min,c=this.chart.scale.max,d=0;d<a.length;d++)for(var e=0;e<a[d].features.length;e++){var f=a[d].features[e],g=f.position,h=f.getEnd();if(g>=b&&g<=c||h>=b&&h<=c)for(var i=Math.round(f.getPixelPositionX()),j=Math.round(i+f.getPixelLength()),k=i;k<=j;k++)this.coverageData[k]=this.coverageData[k]+1||1,this.maxDepth=Math.max(this.coverageData[k],this.maxDepth)}},erase:function(){var a=this;a.chart.ctx.clearRect(0,a.getPixelPositionY(),a.chart.width,a.getHeight())},draw:function(){var a=this,b=!1;for(var c in a.hooks)b=a.hooks[c](a)||b;if("waiting"==a.status)return void(a.drawOnResponse=!0);if(!a.hide){var d=a.getDrawStyle(),e=a.chart.laneSizes,f=a.lanes,g=a.chart.laneBuffer,h=a.chart.trackBuffer,i=e+h,j=a.chart.ctx;if(!b)if(void 0==d||"expand"==d){for(var c=0;c<f.length;c++)if(f[c].y=i,f[c].draw()){var k=f[c].getHeight();j.translate(0,k+g),i=i+k+g}}else if("collapse"==d){for(var l=[],c=0;c<f.length;c++)l=l.concat(f[c].filterFeaturesByPosition(a.chart.scale.min,a.chart.scale.max));l.sort(function(a,b){return a.position-b.position});for(var m=0;m<l.length;m++){var n=l[m].length,o=l[m].name;l[m].draw(),l[m].length=n,l[m].name=o}f.length>0&&j.translate(0,f[0].getHeight()+g)}else if("line"==d){a.coverageData=[],0==a.coverageData.length&&a.calcCoverageData();var q=this.maxDepth;j.beginPath();for(var r=this.chart.offset;r<=this.chart.width+this.chart.offset;r++){var s=a.coverageData[r]/q*e||0;s=e-s,j.lineTo(r,s)}j.lineTo(this.chart.width+this.chart.offset,e),j.stroke(),j.translate(0,f[0].getHeight()+g)}j.translate(0,h-g)}},addDrawHook:function(a,b){var c=b||_uniqueId("drawHook");return this.hooks[c]=a,c},removeDrawHook:function(a){delete this.hooks[a]}}),idCounter=0;_uniqueId=function(a){var b=idCounter++;return a?a+b:b},Object.keys=Object.keys||function(a,b,c){c=[];for(b in a)c.hasOwnProperty.call(a,b)&&c.push(b);
return c},Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==1/0&&d!==-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);e<c;e++)if(e in b&&b[e]===a)return e;return-1});var Arrow=Glyph.extend({init:function(a,b,c,d){this._super(a,b,0,c,d),this.slope=1,this.glyphType="Arrow",this.thickness=4.6},getPixelThickness:function(){var a=this,b=a.getHeight(),c=b/2/Math.tan(Math.atan(a.slope));return a.thickness/10*c},erase:function(){var a=this,b=a.getPixelThickness();a.ctx.clearRect(-b,0,b,a.getHeight())},_draw:function(a,b,c,d){var e=this,a=a||e.ctx,c=c||e.getHeight(),d=d+1||e.calcRoundness();void 0!=d&&(d-=1);var f=e.getPixelThickness(),g=0;x=y=0,a_b_x=x-g-d,a_t_x=x-g-d,a_max_x=x-g,t=.5,a_ctrl_x=(a_max_x-(1-t)*(1-t)*a_b_x-t*t*a_t_x)/(2*(1-t)*t),a_ctrl_y=y+c/2,bs_slope=e.slope,bs_intercept=-a_ctrl_y-bs_slope*a_ctrl_x,ts_slope=-e.slope,ts_intercept=-a_ctrl_y-ts_slope*a_ctrl_x,a_b_y=-(bs_slope*a_b_x+bs_intercept),a_t_y=-(ts_slope*a_t_x+ts_intercept),a.beginPath(),bs_ctrl_y=y+c,bs_ctrl_x=(-bs_ctrl_y-bs_intercept)/e.slope,bs_slpe_x=bs_ctrl_x+d+d,bs_slpe_y=-(bs_slope*bs_slpe_x+bs_intercept),a.moveTo(bs_slpe_x,bs_slpe_y),a.lineTo(a_b_x,a_b_y),a.quadraticCurveTo(a_ctrl_x,a_ctrl_y,a_t_x,a_t_y),ts_ctrl_y=y,ts_ctrl_x=(ts_ctrl_y+ts_intercept)/e.slope,ts_slpe_x=ts_ctrl_x+d+d,ts_slpe_y=-(ts_slope*ts_slpe_x+ts_intercept),a.lineTo(ts_slpe_x,ts_slpe_y);var h=Math.PI-Math.abs(Math.atan(e.slope))-Math.PI/2,i=Math.sin(h)*f,j=Math.cos(h)*f,k=ts_slpe_x-i,l=ts_slpe_y+j;a.bezierCurveTo(ts_ctrl_x,ts_ctrl_y,ts_ctrl_x-i,ts_ctrl_y+j,k,l),a.lineTo(a_max_x-f,y+c/2);var m=bs_slpe_x-i,n=bs_slpe_y-j;a.lineTo(m,n),a.bezierCurveTo(bs_ctrl_x-i,bs_ctrl_y-j,bs_ctrl_x,bs_ctrl_y,bs_slpe_x,bs_slpe_y)}}),BlockArrow=Glyph.extend({init:function(a,b,c,d,e){this._super(a,b,c,d,e),this.slope=1,this.glyphType="BlockArrow"},_draw:function(a,b,c,d){var e=this,a=a||e.ctx,b=b||e.getPixelLength(),c=c||e.getHeight(),d=d+1||e.calcRoundness();void 0!=d&&(d-=1);if(x=y=0,tc_ctrl_x=x,tc_ctrl_y=y,tc_lgth_x=x+d,tc_lgth_y=y,tc_wdth_x=x,tc_wdth_y=y+d,bc_ctrl_x=x,bc_ctrl_y=y+c,bc_lgth_x=x+d,bc_lgth_y=y+c,bc_wdth_x=x,bc_wdth_y=y+c-d,a_b_x=x+b-d,a_t_x=x+b-d,a_max_x=x+b,t=.5,a_ctrl_x=Math.round((a_max_x-(1-t)*(1-t)*a_b_x-t*t*a_t_x)/(2*(1-t)*t)*10)/10,a_ctrl_y=y+c/2,bs_slope=e.slope,bs_intercept=-a_ctrl_y-bs_slope*a_ctrl_x,ts_slope=-e.slope,ts_intercept=-a_ctrl_y-ts_slope*a_ctrl_x,a_b_y=-(Math.round(10*(bs_slope*a_b_x+bs_intercept))/10),a_t_y=-(Math.round(10*(ts_slope*a_t_x+ts_intercept))/10),bs_ctrl_y=y+c,bs_ctrl_x=(-bs_ctrl_y-bs_intercept)/e.slope,bs_ctrl_x<x){var g=new Rect(e.type,0,b);return void g._draw(a,b,c,d)}bs_lgth_y=y+c,bs_lgth_x=bs_ctrl_x-d,bs_slpe_x=bs_ctrl_x+d,bs_slpe_y=-(Math.round(10*(bs_slope*bs_slpe_x+bs_intercept))/10),ts_ctrl_y=y,ts_ctrl_x=(ts_ctrl_y+ts_intercept)/e.slope,ts_lgth_y=y,ts_lgth_x=ts_ctrl_x-d,ts_slpe_x=ts_ctrl_x+d,ts_slpe_y=-(Math.round(10*(ts_slope*ts_slpe_x+ts_intercept))/10),a.beginPath(),a.moveTo(tc_lgth_x,tc_lgth_y),a.quadraticCurveTo(tc_ctrl_x,tc_ctrl_y,tc_wdth_x,tc_wdth_y),a.lineTo(bc_wdth_x,bc_wdth_y),a.quadraticCurveTo(bc_ctrl_x,bc_ctrl_y,bc_lgth_x,bc_lgth_y),a.lineTo(bs_lgth_x,bs_lgth_y),a.quadraticCurveTo(bs_ctrl_x,bs_ctrl_y,bs_slpe_x,bs_slpe_y),a.lineTo(a_b_x,a_b_y),a.quadraticCurveTo(a_ctrl_x,a_ctrl_y,a_t_x,a_t_y),a.lineTo(ts_slpe_x,ts_slpe_y),a.quadraticCurveTo(ts_ctrl_x,ts_ctrl_y,ts_lgth_x,ts_lgth_y),a.lineTo(tc_lgth_x,tc_lgth_y)}}),Complex=Glyph.extend({init:function(a,b,c,d,e,f){this._super(a,b,c,d,f),this.slope=1,this.glyphType="Complex",this.subFeatures=e,this.line=new Line(a,0,c),this.line.parent=this,this.line.color="black",this.line.thickness=2},addSubFeature:function(a){this.subFeatures.push(a)},_draw:function(a,b,c,d){var e=this,a=a||e.ctx,b=b||e.getPixelLength(),c=c||e.getHeight(),d=d+1||e.calcRoundness();void 0!=d&&(d-=1),x=y=0,a.translate(-e.getPixelPositionX(),0),e.line.lane=this.lane,e.line.draw();for(var f=e.subFeatures.length,g=0;g<f;g++)e.subFeatures[g].parent=e,e.subFeatures[g].lane=e.lane,e.subFeatures[g].draw();a.translate(e.getPixelPositionX(),0),a.beginPath()}}),Line=Glyph.extend({init:function(a,b,c,d){this.thickness=2,this._super(a,b,c,void 0,d),this.glyphType="Line"},_draw:function(a,b,c,d){var e=this,a=a||e.ctx,b=b||e.getPixelLength(),c=c||e.getHeight();x=y=0,a.beginPath(),a.moveTo(x,c/2-e.thickness/2),a.lineTo(x,c/2+e.thickness/2),a.lineTo(x+b,c/2+e.thickness/2),a.lineTo(x+b,c/2-e.thickness/2)}}),Rect=Glyph.extend({init:function(a,b,c,d){this._super(a,b,c,void 0,d),this.glyphType="Rect"},_draw:function(a,b,c,d){var e=this,a=a||e.ctx,b=b||e.getPixelLength(),c=c||e.getHeight(),d=d+1||e.calcRoundness();void 0!=d&&(d-=1),x=y=0,a.beginPath(),tlc_ctrl_x=x,tlc_ctrl_y=y,tlc_lgth_x=x+d,tlc_lgth_y=y,tlc_wdth_x=x,tlc_wdth_y=y+d,blc_ctrl_x=x,blc_ctrl_y=y+c,blc_lgth_x=x+d,blc_lgth_y=y+c,blc_wdth_x=x,blc_wdth_y=y+c-d,brc_ctrl_x=x+b,brc_ctrl_y=y+c,brc_lgth_x=x+b-d,brc_lgth_y=y+c,brc_wdth_x=x+b,brc_wdth_y=y+c-d,trc_ctrl_x=x+b,trc_ctrl_y=y,trc_lgth_x=x+b-d,trc_lgth_y=y,trc_wdth_x=x+b,trc_wdth_y=y+d,a.moveTo(tlc_lgth_x,tlc_lgth_y),a.quadraticCurveTo(tlc_ctrl_x,tlc_ctrl_y,tlc_wdth_x,tlc_wdth_y),a.lineTo(blc_wdth_x,blc_wdth_y),a.quadraticCurveTo(blc_ctrl_x,blc_ctrl_y,blc_lgth_x,blc_lgth_y),a.lineTo(brc_lgth_x,brc_lgth_y),a.quadraticCurveTo(brc_ctrl_x,brc_ctrl_y,brc_wdth_x,brc_wdth_y),a.lineTo(trc_wdth_x,trc_wdth_y),a.quadraticCurveTo(trc_ctrl_x,trc_ctrl_y,trc_lgth_x,trc_lgth_y),a.lineTo(tlc_lgth_x,tlc_lgth_y)}}),Seq=Glyph.extend({init:function(a,b,c,d,e){this.seq=d,this.insertions=[],this.fraction=1,this.fractionLevel=.3,this.glyphType="Seq",this.font="8px courier",this.chars={},this.chars.width=void 0,this.chars.height=void 0,this.chars.list=["A","G","T","C","N","-"],this._super(a,b,c,void 0,e)},_draw:function(a,b,c){var d=this,e=1;d.lane.chart.ntsToPixels()<=d.fractionLevel&&(e=this.fraction);var a=a||d.ctx,b=b||d.getPixelLength(),c=c||d.getHeight(),f=d.getPixelPositionX(),g=d.getPixelPositionY(),h=SCRIBL.chars;if(!h.heights[c]){h.heights[c]=[];for(var i=0;i<this.chars.list.length;i++){var j=this.chars.list[i],k=j;"-"==j&&(k="dash");var l="nt_"+k+"_bg";this.createChar(j,h.nt_color,h[l],c)}}if(x=y=0,d.imgCanvas)a.drawImage(d.imgCanvas,f,g-c*e,b,c*e);else{a.save(),a.beginPath(),a.textBaseline="middle";var m=a.font,n=/[\d+px]/.exec(m)+"px";a.font=n+" courier",a.fillStyle="black",a.textAlign="left";var o=this.seq.length*h.heights[c].width;d.imgCanvas=document.createElement("canvas"),d.imgCanvas.width=o,d.imgCanvas.height=c;for(var p=d.imgCanvas.getContext("2d"),q=0,r=0,i=0;i<this.seq.length;i++){h.heights[c][this.seq[i]]||this.createChar(this.seq[i],"black","white",c);var s=this.seq[i];if(this.insertions.length>1);this.insertions[r]&&void 0!=this.insertions[r].pos&&(this.insertions[r].pos-1==i?s+="rightInsert":this.insertions[r]&&this.insertions[r].pos==i&&(s+="leftInsert",r++)),p.drawImage(h.heights[c][s],q,y),q+=h.heights[c].width}a.drawImage(d.imgCanvas,x,c-c*e,b,c*e),a.font=m,a.restore()}a.beginPath(),a.moveTo(0,0),a.lineTo(b,y),a.lineTo(b,y+c),a.lineTo(x,y+c),a.lineTo(x,y),a.fillStyle="rgba(0,0,0,0)",d.lane.chart.ntsToPixels()<=d.fractionLevel?a.strokeStyle="rgba(0,0,0,1)":a.strokeStyle="rgba(0,0,0,0)",a.stroke(),a.closePath()},createChar:function(a,b,c,d){var e=this,g=(e.lane.track.chart,document.createElement("canvas")),h=g.getContext("2d"),i=2,j=d-i;h.font=j+"px courier";var k=h.measureText(a).width+i;g.height=d,g.width=k,SCRIBL.chars.heights[d].width=k;var g=document.createElement("canvas"),h=g.getContext("2d");h.font=j+"px courier",g.height=d,g.width=k;var l=h.fillStyle;h.fillStyle=c,h.fillRect(0,0,k,d),h.fillStyle=b,h.textAlign="center",h.textBaseline="middle",h.fillText(a,k/2,d/2),SCRIBL.chars.heights[d][a]=g,h.fillStyle=l;var g=document.createElement("canvas"),h=g.getContext("2d");h.font=j+"px courier",g.height=d,g.width=k;var l=h.fillStyle;h.fillStyle=c,h.fillRect(0,0,k,d),h.fillStyle="yellow",h.beginPath(),h.moveTo(0,d),h.arcTo(k,d,k,0,d/2),h.lineTo(k,d),h.lineTo(0,d),h.closePath(),h.fill(),h.fillStyle=b,h.textAlign="center",h.textBaseline="middle",h.fillText(a,k/2,d/2),SCRIBL.chars.heights[d][a+"rightInsert"]=g,h.fillStyle=l;var g=document.createElement("canvas"),h=g.getContext("2d");h.font=j+"px courier",g.height=d,g.width=k;var l=h.fillStyle;h.fillStyle=c,h.fillRect(0,0,k,d),h.fillStyle="yellow",h.beginPath(),h.moveTo(k,d),h.arcTo(0,d,0,0,d/2),h.lineTo(0,d),h.lineTo(k,d),h.closePath(),h.fill(),h.fillStyle=b,h.textAlign="center",h.textBaseline="middle",h.fillText(a,k/2,d/2),SCRIBL.chars.heights[d][a+"leftInsert"]=g,h.fillStyle=l}});